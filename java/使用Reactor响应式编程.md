[è¿”å›ä¸Šå±‚](index)
# ä½¿ç”¨Reactorå“åº”å¼ç¼–ç¨‹

## ä»‹ç»

### å“åº”å¼ç¼–ç¨‹

å“åº”å¼ç¼–ç¨‹ä¸åŒäºæˆ‘ä»¬ç†Ÿæ‚‰çš„å‘½ä»¤å¼ç¼–ç¨‹ï¼Œæˆ‘ä»¬ç†Ÿæ‚‰çš„å‘½ä»¤å¼ç¼–ç¨‹å³**ä»£ç å°±æ˜¯ä¸€è¡Œæ¥ä¸€è¡Œçš„æŒ‡ä»¤ï¼ŒæŒ‰ç…§å®ƒä»¬çš„é¡ºåºä¸€æ¬¡ä¸€æ¡åœ°å‡ºç°ã€‚ä¸€ä¸ªä»»åŠ¡è¢«æ‰§è¡Œï¼Œç¨‹åºå°±éœ€è¦ç­‰åˆ°å®ƒæ‰§è¡Œå®Œäº†ï¼Œæ‰èƒ½æ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚æ¯ä¸€æ­¥ï¼Œæ•°æ®éƒ½éœ€è¦å®Œå…¨è·å–åˆ°äº†æ‰èƒ½è¢«å¤„ç†ï¼Œå› æ­¤å®ƒéœ€è¦ä½œä¸ºä¸€ä¸ªæ•´ä½“æ¥å¤„ç†**ã€‚ä½†æ˜¯æ‰€è°“çš„å“åº”å¼ç¼–ç¨‹**æ˜¯å‡½æ•°å¼å’Œå£°æ˜å¼çš„ã€‚å“åº”å¼æµå¤„ç†æ•°æ®æ—¶åªè¦æ•°æ®æ˜¯å¯ç”¨çš„å°±è¿›è¡Œå¤„ç†ï¼Œè€Œä¸æ˜¯éœ€è¦å°†æ•°æ®ä½œä¸ºä¸€ä¸ªæ•´ä½“è¿›è¡Œæä¾›ã€‚äº‹å®ä¸Šï¼Œè¾“å…¥æ•°æ®å¯ä»¥æ˜¯æ— ç©·çš„ï¼ˆä¾‹å¦‚ï¼Œä¸€ä¸ªåœ°ç‚¹çš„å®æ—¶æ¸©åº¦æ•°æ®çš„æ’å®šæµï¼‰ã€‚**å¦‚ä¸‹é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥æè¿°å“åº”å¼ç¼–ç¨‹å’Œå‘½ä»¤å¼ç¼–ç¨‹çš„å·®åˆ«ï¼š

ğŸŒ°ï¼šæŸåœ°å‘ç”Ÿç«ç¾ï¼Œé™„è¿‘æœ‰ä¸€ä¸ªæ°´æ± ï¼Œæˆ‘ä»¬éœ€è¦åˆ©ç”¨æ°´æ± ä¸­çš„æ°´æ¥ç­ç«ã€‚

é¦–å…ˆæˆ‘ä»¬å°†è¿™ä¸€ç³»åˆ—æ­¥éª¤è¿›è¡Œä»»åŠ¡æŠ½è±¡ï¼š

1. å–åˆ°æ°´æ± ä¸­çš„æ°´ã€‚
2. æŠŠæ°´è¿é€åˆ°ç«ç¾åœ°è¿›è¡Œç­ç«ã€‚

é‚£ä¹ˆå‘½ä»¤å¼ç¼–ç¨‹ï¼Œæˆ‘ä»¬æŠŠä¸€æ± æ°´éƒ½çœ‹æˆä¸€ä¸ªæ•´ä½“ï¼Œé‚£ä¸ªé¦–å…ˆæˆ‘ä»¬éœ€è¦å°†ä¸€æ± å­çš„æ°´å…¨éƒ¨æ”¾å…¥æ•‘ç«è½¦ä¸­ï¼Œå…¨éƒ¨æ”¾å®Œåæ‰èƒ½æ‹‰ç€è¿™ä¸€æ± å­æ°´èµ¶å¾€ç«ç¾åœ°è¿›è¡Œç­ç«ã€‚è¿™ä¹Ÿç¬¦åˆä¸Šé¢å¯¹å‘½ä»¤å¼ç¼–ç¨‹çš„æè¿°ã€‚**ä¸€ä¸ªä»»åŠ¡è¢«æ‰§è¡Œï¼Œç¨‹åºå°±éœ€è¦ç­‰åˆ°å®ƒæ‰§è¡Œå®Œäº†ï¼Œæ‰èƒ½æ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚æ¯ä¸€æ­¥ï¼Œæ•°æ®éƒ½éœ€è¦å®Œå…¨è·å–åˆ°äº†æ‰èƒ½è¢«å¤„ç†ï¼Œå› æ­¤å®ƒéœ€è¦ä½œä¸ºä¸€ä¸ªæ•´ä½“æ¥å¤„ç†**ã€‚

ä½†æ˜¯å“åº”å¼ç¼–ç¨‹å°±ä¸ä¸€æ ·äº†ï¼Œå“åº”å¼ç¼–ç¨‹å¹¶ä¸è¦æ±‚æˆ‘ä»¬æŠŠä¸€æ± å­æ°´çœ‹æˆä¸€ä¸ªæ•´ä½“ï¼Œè€Œæ˜¯ä¸€ç³»åˆ—ï¼ˆæ— ç©·çš„æ°´æ»´ï¼‰ï¼Œæˆ‘ä»¬çš„åšæ³•å°±åƒæ‹‰ä¸€æ ¹å¾ˆé•¿çš„æ°´ç®¡ï¼Œä¸€ç«¯è¿ç€æ°´æ± ï¼Œä¸€ç«¯åœ¨ç«ç¾åœ°ã€‚æˆ‘ä»¬ä½¿ç”¨æŠ½æ°´æœºæŠŠæ°´æºæºä¸æ–­çš„è¾“é€åˆ°ç«ç¾åœ°è¿›è¡Œç­ç«ï¼Œè€Œä¸éœ€è¦å‘½ä»¤å¼ç¼–ç¨‹é‚£æ ·å¿…é¡»ä¸€ä¸ªä»»åŠ¡ä¸€ä¸ªä»»åŠ¡ä¸²è¡Œã€‚å³ï¼š**å“åº”å¼æµå¤„ç†æ•°æ®æ—¶åªè¦æ•°æ®æ˜¯å¯ç”¨çš„å°±è¿›è¡Œå¤„ç†ï¼Œè€Œä¸æ˜¯éœ€è¦å°†æ•°æ®ä½œä¸ºä¸€ä¸ªæ•´ä½“è¿›è¡Œæä¾›ã€‚äº‹å®ä¸Šï¼Œè¾“å…¥æ•°æ®å¯ä»¥æ˜¯æ— ç©·çš„**

é€šè¿‡ä¸Šè¿°çš„ä¾‹å­ï¼Œå¯ä»¥æ¸…æ™°çš„åˆ†è¾¨å“åº”å¼ç¼–ç¨‹å’Œä¼ ç»Ÿçš„å‘½ä»¤å¼ç¼–ç¨‹ã€‚

### Reactor

Reactoræ˜¯åŸºäºå“åº”å¼æµçš„ç¬¬å››ä»£å“åº”å¼åº“è§„èŒƒï¼Œç”¨äºåœ¨JVMä¸Šæ„å»ºéé˜»å¡åº”ç”¨ç¨‹åºã€‚Reactor å·¥ç¨‹å®ç°äº†å“åº”å¼æµçš„è§„èŒƒï¼Œå®ƒæä¾›ç”±å“åº”å¼æµç»„æˆçš„å‡½æ•°å¼ APIã€‚æ­£å¦‚ä½ å°†åœ¨åé¢çœ‹åˆ°çš„ï¼ŒReactor æ˜¯ Spring 5 å“åº”å¼ç¼–ç¨‹æ¨¡å‹çš„åŸºç¡€ã€‚å…³äºå“åº”å¼æµåœ¨è¿™é‡Œç®€è¦ä»‹ç»ä¸‹ï¼š

å“åº”å¼æµçš„è§„èŒƒå¯ä»¥é€šè¿‡å››ä¸ªæ¥å£å®šä¹‰æ¥æ¦‚æ‹¬ï¼šPublisherï¼ŒSubscriberï¼ŒSubscription å’Œ Processorã€‚

- Publisherï¼šæ•°æ®ç”Ÿäº§è€…
- Subscriberï¼šæ•°æ®è®¢é˜…è€…
- Subscriptionï¼šæ•°æ®è½½ä½“
- Processorï¼šå¯¹ç”Ÿäº§è€…çš„æ•°æ®è¿›è¡Œç‰¹å®šå¤„ç†ï¼Œå¹¶ä¼ ç»™Subscriberã€‚

å…³äºå“åº”å¼æµçš„å…·ä½“è§„èŒƒå¯ä»¥çœ‹[è¿™é‡Œ](https://zhuanlan.zhihu.com/p/95966853)ã€‚

å›å¤´çœ‹Reactorä¸­ï¼Œå­˜åœ¨ä¸¤ä¸ªæ ¸å¿ƒæ¦‚å¿µ:Monoå’ŒFluxã€‚

Flux è¡¨ç¤ºé›¶ä¸ªã€ä¸€ä¸ªæˆ–å¤šä¸ªï¼ˆå¯èƒ½æ˜¯æ— é™ä¸ªï¼‰æ•°æ®é¡¹çš„ç®¡é“ã€‚

Mono ç‰¹å®šç”¨äºå·²çŸ¥çš„æ•°æ®è¿”å›é¡¹ä¸å¤šäºä¸€ä¸ªçš„å“åº”å¼ç±»å‹ã€‚

ä½¿ç”¨å¼¹ç å›¾æ¥æè¿°äºŒè€…ï¼š

Fluxï¼š

![](http://dxsn-1300740068.cos.ap-nanjing.myqcloud.com/2021-12-11-162714.jpg)



Monoï¼š

 ![](http://dxsn-1300740068.cos.ap-nanjing.myqcloud.com/2021-12-11-162727.jpg)

---

## Spring Bootä¸­ä½¿ç”¨Reactor

### æ·»åŠ ä¾èµ–

```xml
<!--Reactorä¸­çš„æ ¸å¿ƒåº“-->
<dependency>
    <groupId>io.projectreactor</groupId>
    <artifactId>reactor-core</artifactId>
</dependency>
<!--Reactoræµ‹è¯•åº“-->
<dependency>
    <groupId>io.projectreactor</groupId>
    <artifactId>reactor-test</artifactId>
    <scope>test</scope>
</dependency>
```

---

## Reactorä½¿ç”¨ç¤ºä¾‹

Fluxå’ŒMonoçš„æ“ä½œæ–¹æ³•æœ‰å¾ˆå¤šï¼Œæˆ‘ä»¬å¤§è‡´çš„å°†ä»–ä»¬çš„æ‰€æœ‰æ“ä½œåˆ†ä¸ºå››ç±»ï¼š

- åˆ›å»ºæ“ä½œ
- è”åˆæ“ä½œ
- ä¼ è¾“æ“ä½œ
- é€»è¾‘å¤„ç†æ“ä½œ

### åˆ›å»ºæ“ä½œ

ä½¿ç”¨just()æ–¹æ³•å¹¶ä¼ å…¥å…ƒç´ æ¥åˆ›å»ºFluxï¼š

```java
@Test
public void åˆ›å»ºä¸€ä¸ªFluxå¹¶ä¸”è¾“å‡º() {
  Flux<String> flux = Flux.just("1", "2", "3", "4", "5");
  flux.subscribe(f -> System.out.println("Here's some number: " + f));
}
```



æˆ‘ä»¬å¯ä»¥ä¼ å…¥æ•°ç»„ï¼Œé›†åˆï¼ŒStreamç±»æ¥åˆ›å»ºFluxï¼š

```java
@Test
public void ä»æ•°ç»„ä¸­åˆ›å»ºä¸€ä¸ªé›†åˆ() {
    String[] strs = {"1", "2", "3"};
    Flux<String> flux = Flux.fromArray(strs);
    StepVerifier.create(flux)
      .expectNext("1")
      .expectNext("2")
      .expectNext("3")
      .verifyComplete();

    List<String> strList = new ArrayList<>();
    strList.add("1");
    strList.add("2");
    strList.add("3");
    Flux.fromIterable(strList);

    Flux.fromStream(strList.stream());
}
```



æŒ‡å®šä¸€ä¸ªèŒƒå›´æ¥åˆ›å»ºFluxï¼š

```java
@Test
public void æä¾›èŒƒå›´ç”Ÿæˆä¸€ä¸ªFlux() {
    Flux<Integer> flux = Flux.range(0, 3);
    StepVerifier.create(flux)
      .expectNext(0)
      .expectNext(1)
      .expectNext(2)
      .verifyComplete();

  	//ğŸŒæ¥ä¸ªé™„åŠ æ“ä½œï¼šintervalæ–¹æ³•è®¾ç½®Fluxå‘é€æ•°æ®çš„é¢‘ç‡ï¼Œè¿™é‡Œè®¾ç½®æ¯ä¸€ç§’å‘é€ä¸€æ¬¡ã€‚
  	//ğŸŒ›takeæ–¹æ³•è¡¨ç¤ºé™åˆ¶æ¡ç›®æ•°é‡ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬è®¾å®šFluxæœ€å¤šå‘é€ä¸‰æ¡æ•°æ®ã€‚
    Flux<Long> flux1 = Flux.interval(Duration.ofSeconds(1L)).take(3L);
    StepVerifier.create(flux1)
      .expectNext(0L)
      .expectNext(1L)
      .expectNext(2L)
      .verifyComplete();
}
```

### è”åˆæ“ä½œ

Fluxæä¾›äº†å¤šç§è”åˆæ“ä½œï¼Œæ¥ç»“åˆå¤šä¸ªFluxæµè¿›è¡Œæ“ä½œï¼š

**mergeæ“ä½œï¼š**

```java
@Test
public void mergeå¤šä¸ªFlux() {
    Flux<Integer> flux = Flux.range(0, 3).delayElements(Duration.ofMillis(500));
    Flux<Integer> flux1 = Flux.range(3,2).delaySubscription(Duration.ofMillis(250))
      .delayElements(Duration.ofMillis(500));
  	//ğŸ‘‹ä½¿ç”¨mergeWithæ–¹æ³•æ¥ç»“åˆä¸¤ä¸ªFluxæµï¼ŒmergeWithæ–¹æ³•ä¸èƒ½ä¿è¯åˆå¹¶åçš„æµä¸­å…ƒç´ çš„é¡ºåº
  	//ğŸ‘‹æ‰€ä»¥ä¸Šé¢æ“ä½œæˆ‘ä»¬ä½¿ç”¨delaySubscriptionå’ŒdelayElementsæ¥ä¿è¯å…ƒç´ çš„é¡ºåº
  	//delaySubscriptionï¼šæŒ‡å®šæ—¶é—´å»¶è¿Ÿå‘é€  delayElementsï¼šå‘é€å…ƒç´ çš„æ—¶é—´é—´éš” 
    Flux<Integer> flux2 = flux.mergeWith(flux1);
    flux2.subscribe(f -> System.out.println("Here's some number: " + f));
    StepVerifier.create(flux2)
      .expectNext(0)
      .expectNext(3)
      .expectNext(1)
      .expectNext(4)
      .expectNext(2)
      .verifyComplete();
}
```

å›¾è§£ä¸Šè¿°ä»£ç ï¼š

![](http://dxsn-1300740068.cos.ap-nanjing.myqcloud.com/2021-12-11-162734.jpg)

**zipæ“ä½œï¼š**

```java
@Test
public void åˆå¹¶å¤šä¸ªFlux() {
  Flux<Integer> flux = Flux.range(0, 3).delayElements(Duration.ofMillis(500));
  Flux<Integer> flux1 = Flux.range(3, 2).delaySubscription(Duration.ofMillis(250))
    .delayElements(Duration.ofMillis(500));
	//ğŸ‘‹zipæ“ä½œå°†åˆå¹¶ä¸¤ä¸ªFluxæµï¼Œå¹¶ä¸”ç”Ÿæˆä¸€ä¸ªTuple2å¯¹è±¡ï¼ŒTuple2ä¸­åŒ…å«ä¸¤ä¸ªæµä¸­åŒé¡ºåºçš„å…ƒç´ å„ä¸€ä¸ªã€‚
  Flux<Tuple2<Integer, Integer>> flux3 = Flux.zip(flux, flux1);
  flux3.take(3).subscribe(f -> System.out.println(f.toString()));
  StepVerifier.create(flux3)
    .expectNextMatches(t -> t.getT1() == 0 && t.getT2() == 3)
    .expectNextMatches(t -> t.getT1() == 1 && t.getT2() == 4)
    .verifyComplete();
}
```

å›¾è§£ä¸Šè¿°ä»£ç ï¼š

![](http://dxsn-1300740068.cos.ap-nanjing.myqcloud.com/2021-12-11-162739.jpg)

**zipé…åˆæŒ‡å®šé€»è¾‘æ“ä½œï¼š**

```java
@Test
    public void åˆå¹¶å¤šä¸ªFlux() {
        Flux<Integer> flux = Flux.range(0, 3).delayElements(Duration.ofMillis(500));
        Flux<Integer> flux1 = Flux.range(3, 2).delaySubscription(Duration.ofMillis(250))
          .delayElements(Duration.ofMillis(500));
				//ğŸ‘‹åœ¨zipæ“ä½œä¸­ä¼ å…¥æŒ‡å®šçš„é€»è¾‘æ“ä½œï¼Œè¿”å›ä¸€ä¸ªæ“ä½œç»“æœFlux
        Flux<Integer> flux4 = Flux.zip(flux, flux1, (x, y) -> x + y);
        flux4.take(3).subscribe(f -> System.out.println(f.toString()));
        StepVerifier.create(flux4)
                .expectNext(3)
                .expectNext(5)
                .verifyComplete();
    }
```

å›¾è§£ä¸Šè¿°ä»£ç ï¼š

![](http://dxsn-1300740068.cos.ap-nanjing.myqcloud.com/2021-12-11-162744.jpg)

**firstæ“ä½œï¼š**

```java
@Test
    public void åªè·å–æœ€å…ˆå‘å¸ƒçš„Flux() {
        Flux<Integer> flux = Flux.range(0, 3).delayElements(Duration.ofMillis(500));
        Flux<Integer> flux1 = Flux.range(3, 2).delaySubscription(Duration.ofMillis(250))
          .delayElements(Duration.ofMillis(500));
      	//firstæ“ä½œåªä¼šä½¿ç”¨æœ€å…ˆå‘å¸ƒå…ƒç´ çš„é‚£ä¸ªæµ
        Flux<Integer> flux2 = Flux.first(flux, flux1);
        StepVerifier.create(flux2)
                .expectNext(0)
                .expectNext(1)
                .expectNext(2)
                .verifyComplete();
    }
```

å›¾è§£ä¸Šè¿°æ“ä½œï¼š

![](http://dxsn-1300740068.cos.ap-nanjing.myqcloud.com/2021-12-11-162749.jpg)

### è½¬æ¢&è¿‡æ»¤æ“ä½œ

**skipæ“ä½œ**

```java
@Test
public void è¿‡æ»¤Fluxä¸­çš„æ•°æ®() {
  //ğŸ‘‹skipæ“ä½œï¼Œè·³è¿‡æŒ‡å®šæ•°é‡çš„å…ƒç´ 
  Flux<Integer> flux = Flux.range(0, 10).skip(8);
  StepVerifier.create(flux)
    .expectNext(8)
    .expectNext(9)
    .verifyComplete();
}
```

å›¾è§£ä¸Šè¿°æ“ä½œï¼š

![](http://dxsn-1300740068.cos.ap-nanjing.myqcloud.com/2021-12-11-162754.jpg)

```java
@Test
public void è¿‡æ»¤Fluxä¸­çš„æ•°æ®() {
  //ğŸ‘‹åœ¨skipæ–¹æ³•ä¸­ä¼ å…¥æ˜¯ä¸ªæ—¶é—´æ®µï¼Œè¡¨ç¤ºè·³è¿‡è¿™ä¸ªæ—¶é—´æ®µå†…è¾“å‡ºçš„å…ƒç´ 
  //ğŸ‘‹æ­é…delayElementsæ–¹æ³•ï¼Œæ¯ä¸ª100æ¯«ç§’è¾“å‡ºä¸€æ¬¡
  //ğŸ‘‹æ‰€ä»¥è¿™ä¸ªæµ‹è¯•åªä¼šå¾—åˆ°7ï¼Œ8ï¼Œ9
  Flux<Integer> flux1 = Flux.range(0, 10).delayElements(Duration.ofMillis(100))
  	.skip(Duration.ofMillis(800));
  StepVerifier.create(flux1)
    .expectNext(7)
    .expectNext(8)
    .expectNext(9)
    .verifyComplete();
}
```

å›¾è§£ä¸Šè¿°æ–¹æ³•ï¼š

![](http://dxsn-1300740068.cos.ap-nanjing.myqcloud.com/2021-12-11-162800.jpg)

**takeæ“ä½œ**

```java
@Test
public void è¿‡æ»¤Fluxä¸­çš„æ•°æ®() {
  //ğŸ‘‹takeæ“ä½œä¸skipç›¸åï¼Œè¡¨ç¤ºè·å–æŒ‡å®šæ•°é‡çš„å‰å‡ ä¸ªå…ƒç´ 
  Flux<Integer> flux2 = Flux.range(0, 10).delayElements(Duration.ofMillis(100))
    .take(Duration.ofMillis(350));
  StepVerifier.create(flux2)
    .expectNext(0)
    .expectNext(1)
    .expectNext(2)
    .verifyComplete();
}
```

å›¾è§£ä¸Šè¿°æ–¹æ³•ï¼š

![](http://dxsn-1300740068.cos.ap-nanjing.myqcloud.com/2021-12-11-162806.jpg)

```java
@Test
public void take() {
  	//ğŸ‘‹takeæ–¹æ³•æ”¯æŒä¼ å…¥ä¸€ä¸ªæ—¶é—´æ®µï¼Œè¡¨ç¤ºåªå–è¿™ä¸ªæ—¶é—´æ®µå†…å‘å¸ƒçš„å…ƒç´ 
  	//ğŸ‘‹ä¸‹é¢æ“ä½œä¸­æˆ‘ä»¬è§„å®šä¸€ç§’å‘å¸ƒä¸€ä¸ªå…ƒç´ ï¼Œå–3.5ç§’å†…çš„å…ƒç´ 
  	//ğŸ‘‹æ‰€ä»¥æœ€ååªèƒ½å¾—åˆ°å‰ä¸‰ä¸ªå…ƒç´ 
    Flux<String> nationalParkFlux = Flux.just(
        "Yellowstone", "Yosemite", "Grand Canyon","Zion", "Grand Teton")
        .delayElements(Duration.ofSeconds(1))
        .take(Duration.ofMillis(3500));
    
    StepVerifier.create(nationalParkFlux)
        .expectNext("Yellowstone", "Yosemite", "Grand Canyon")
        .verifyComplete();
}
```

å›¾è§£ä¸Šè¿°æ–¹æ³•ï¼š

![](http://dxsn-1300740068.cos.ap-nanjing.myqcloud.com/2021-12-11-162810.jpg)

**filteræ“ä½œ**

```java
@Test
public void è¿‡æ»¤Fluxä¸­çš„æ•°æ®() {
  //ğŸ‘‹filteræ–¹æ³•è§„å®šä¸€ä¸ªæ¡ä»¶ï¼Œåªæ‹¿å–ç¬¦åˆæ¡ä»¶çš„å…ƒç´ 
  //ğŸ‘‹ä¸‹é¢æ“ä½œä¸­ï¼Œæˆ‘ä»¬åªæ‹¿å–å°äº2çš„å…ƒç´ 
  Flux<Integer> flux3 = Flux.range(0, 10).filter(n -> n < 2);
  StepVerifier.create(flux3)
    .expectNext(0)
    .expectNext(1)
    .verifyComplete();
}
```

å›¾è§£ä¸Šè¿°æ–¹æ³•ï¼š

![](http://dxsn-1300740068.cos.ap-nanjing.myqcloud.com/2021-12-11-162815.jpg)

**distinctæ“ä½œ**

```java
ja@Test
public void è¿‡æ»¤Fluxä¸­çš„æ•°æ®() {
  //ğŸ‘‹distinctæ–¹æ³•ç”¨äºå…ƒç´ å»é‡
  Flux<Integer> flux4 = Flux.just(1, 2, 3, 3, 4, 5, 5).distinct();
  StepVerifier.create(flux4)
    .expectNext(1)
    .expectNext(2)
    .expectNext(3)
    .expectNext(4)
    .expectNext(5)
    .verifyComplete();
}

```

å›¾è§£ä¸Šè¿°æ–¹æ³•ï¼š

![](http://dxsn-1300740068.cos.ap-nanjing.myqcloud.com/2021-12-11-162821.jpg)

**mapæ“ä½œ**

```java
@Test
public void æ˜ å°„Flux() {
	//ğŸ‘‹mapæ–¹æ³•ï¼Œå°†å…ƒç´ è½¬æ¢æˆæŒ‡å®šçš„å¦ä¸€ç§æ•°æ®
  //ğŸ‘‹ä¸‹é¢æ“ä½œä¸­æˆ‘ä»¬ä¼ å…¥ä¸€ä¸ªåŒ¿åçš„è½¬æ¢ç±»ï¼ŒæŒ‡å®šäº†æˆ‘ä»¬å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°å­—
  Flux<Integer> flux = Flux.just("1", "2", "3")
  	.map(Integer::valueOf);
  StepVerifier.create(flux)
    .expectNext(1)
    .expectNext(2)
    .expectNext(3)
    .verifyComplete();
}
```

å›¾è§£å¦‚ä¸Šæ–¹æ³•ï¼š

![](http://dxsn-1300740068.cos.ap-nanjing.myqcloud.com/2021-12-11-162826.jpg)

**flatMapæ“ä½œ**

flatMap() å°†æ¯ä¸ªå¯¹è±¡æ˜ å°„åˆ°ä¸€ä¸ªæ–°çš„ Mono æˆ– Fluxï¼Œæœ€åè¿™äº›æ–°çš„Monoæˆ–è€…Fluxä¼šè¢«å‹æˆï¼ˆåˆæˆï¼‰ä¸€ä¸ªæ–°çš„Fluxã€‚

```java
@Test
public void æ˜ å°„Flux() {
  //ğŸ‘‹å¦‚ä¸‹çš„flatMapæ–¹æ³•å°†ä¼ å…¥çš„æ¯ä¸ªå…ƒç´ éƒ½è½¬æˆä¸€ä¸ªMono
  //ğŸ‘‹éšååœ¨Monoé‡Œé¢ä¼ å…¥ä¸€ä¸ªmapè½¬æ¢é€»è¾‘ï¼ˆString->Integerï¼‰
  //ğŸ‘‹ä½¿ç”¨subscribeOnæ¥åšäº†ä¸€ä¸ªå¼‚æ­¥å¤„ç†
  //ğŸ‘‹æœ€ç»ˆä¼šå½¢æˆä¸€ä¸ªæ–°çš„Fluxï¼ŒåŒ…å«æ¥è½¬æ¢åçš„å…ƒç´ ï¼Œä½†æ˜¯ç”±äºå¼‚æ­¥ï¼Œä¸èƒ½ä¿è¯é¡ºåº
  Flux<Integer> flux1 = Flux.just("1", "2", "3", "4")
    .flatMap(m -> Mono.just(m).map(c -> Integer.valueOf(c))
             .subscribeOn(Schedulers.parallel()));
  List<Integer> list = Stream.of(1, 2, 3, 4).collect(Collectors.toList());
  StepVerifier.create(flux1)
    .expectNextMatches(list::contains)
    .expectNextMatches(list::contains)
    .expectNextMatches(list::contains)
    .expectNextMatches(list::contains)
    .verifyComplete();
}
```

å›¾è§£ä¸Šè¿°ä»£ç ï¼š

![](http://dxsn-1300740068.cos.ap-nanjing.myqcloud.com/2021-12-11-162833.jpg)

**bufferæ“ä½œ**

```java
@Test
public void ç¼“å†²Flux() {
  Flux<Integer> flux = Flux.just(1, 2, 3, 4, 5, 6);
  //ğŸ‘‹bufferæ–¹æ³•èµ·åˆ°ä¸€ä¸ªç¼“å†²çš„ä½œç”¨
  //ğŸ‘‹æˆ‘ä»¬åœ¨bufferä¸­æŒ‡å®šä¸€ä¸ªæ•°å­—ï¼Œåªæœ‰bufferè¢«å……æ»¡æ—¶æˆ–è€…æ²¡æœ‰å‰©ä½™å…ƒç´ æ—¶ï¼Œæ‰ä¼šå‘å¸ƒå‡ºå»
  //ğŸ‘‹å› ä¸ºä½ æœ‰äº†ç¼“å­˜ï¼Œæ‰€ä»¥å‘å¸ƒå‡ºå»çš„æ˜¯ä¸€ä¸ªå…ƒç´ é›†åˆ
  Flux<List<Integer>> listFlux = flux.buffer(3);
  StepVerifier.create(listFlux)
    .expectNext(Arrays.asList(1, 2, 3))
    .expectNext(Arrays.asList(4, 5, 6))
    .verifyComplete();

  //ğŸ‘‹è¿è¡Œä¸‹é¢çš„ä»£ç ï¼ŒæŸ¥çœ‹bufferæ˜¯å¦‚ä½•å·¥ä½œçš„
  Flux.just("apple", "orange", "banana", "kiwi", "strawberry")
    .buffer(3)
    .flatMap(x ->
             Flux.fromIterable(x)
             .map(y -> y.toUpperCase())
             .subscribeOn(Schedulers.parallel())
             .log()
            ).subscribe();
}
```

å›¾è§£ä¸Šè¿°æ–¹æ³•ï¼š

![](http://dxsn-1300740068.cos.ap-nanjing.myqcloud.com/2021-12-11-162839.jpg)

**collectListæ“ä½œ**

```java
@Test
public void ç¼“å†²Flux() {
  Flux<Integer> flux1 = Flux.range(1, 6);
  //ğŸ‘‹collectListæ–¹æ³•ç”¨äºå°†å«æœ‰å¤šä¸ªå…ƒç´ çš„Fluxè½¬æ¢ä¸ºå«æœ‰ä¸€ä¸ªå…ƒç´ åˆ—è¡¨çš„Mono
  Mono<List<Integer>> mono2 = flux1.collectList();
  StepVerifier.create(mono2)
    .expectNext(Arrays.asList(1, 2, 3, 4, 5, 6))
    .verifyComplete();
}
```

å›¾è§£ä¸Šè¿°æ–¹æ³•ï¼š

![](http://dxsn-1300740068.cos.ap-nanjing.myqcloud.com/2021-12-11-162845.jpg)

**collectMapæ“ä½œ**

```java
@Test
public void ç¼“å†²Flux() {
  	//ğŸ‘‹collectMapæ–¹æ³•ç”¨äºå°†å«æœ‰å¤šä¸ªå…ƒç´ çš„Fluxè½¬æ¢ä¸ºå«æœ‰ä¸€ä¸ªMapçš„Mono
  	//ğŸ‘‹collectMapæ–¹æ³•ä¸­ä¼ å…¥çš„æ˜¯ç”Ÿæˆé”®çš„é€»è¾‘
    Flux<Integer> flux2 = Flux.range(1, 6);
    Mono<Map<Object, Integer>> mapMono = flux2.collectMap(f -> String.valueOf(f + "i"));
    StepVerifier.create(mapMono)
      .expectNextMatches(m -> m.size() == 6
                         && m.get("1i").equals(1)
                         && m.get("2i").equals(2)
                         && m.get("3i").equals(3))
      .verifyComplete();
}
```

å›¾è§£ä¸Šè¿°æ–¹æ³•ï¼š

![](http://dxsn-1300740068.cos.ap-nanjing.myqcloud.com/2021-12-11-162851.jpg)

### é€»è¾‘æ“ä½œ

```java
@Test
public void Fluxçš„é€»è¾‘æ“ä½œ() {
  	//ğŸ‘‹æœ‰æ—¶ä½ åªéœ€è¦çŸ¥é“ Mono æˆ– Flux å‘å¸ƒçš„æ¡ç›®æ˜¯å¦ç¬¦åˆæŸäº›æ¡ä»¶ã€‚all() å’Œ any() æ“ä½œå°†æ‰§è¡Œè¿™æ ·çš„é€»è¾‘ã€‚
    Flux<Integer> flux = Flux.just(1, 2, 3, 4, 5, 6);
  	//ğŸ‘‹anyæ–¹æ³•ï¼Œåªè¦ä»»ä½•ä¸€ä¸ªå…ƒç´ ç¬¦åˆè¦æ±‚ï¼Œå³è¿”å›true
    Mono<Boolean> mono = flux.any(f -> f < 0);
    StepVerifier.create(mono)
            .expectNext(false)
            .verifyComplete();
		//ğŸ‘‹allæ–¹æ³•ï¼Œæ‰€æœ‰å…ƒç´ ç¬¦åˆè¦æ±‚ï¼Œå³è¿”å›true
    Mono<Boolean> mono1 = flux.all(f -> f > 0);
    StepVerifier.create(mono1)
            .expectNext(true)
            .verifyComplete();
}
```

å›¾è§£ä¸Šè¿°æ–¹æ³•ï¼š

![](http://dxsn-1300740068.cos.ap-nanjing.myqcloud.com/2021-12-11-162859.jpg)

![](http://dxsn-1300740068.cos.ap-nanjing.myqcloud.com/2021-12-11-162909.jpg)

---

## æ€»ç»“

æœ¬æ–‡ä¸»è¦ä»‹ç»äº†å“åº”å¼ç¼–ç¨‹çš„åŸºæœ¬æ¦‚å¿µï¼Œå¹¶ç”¨ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜å“åº”å¼ç¼–ç¨‹å’Œå‘½ä»¤å¼ç¼–ç¨‹çš„å·®åˆ«ã€‚ä»‹ç»äº†å“åº”å¼æµæ¨¡å‹çš„å®ç°åº“Reactorï¼Œå¹¶ä¸”è§£é‡Šäº†Reactorä¸­çš„ä¸€äº›å“åº”å¼æµæ¦‚å¿µã€‚ä½¿ç”¨SpringBootå¼•å…¥Reactoråº“æ¥è¿›è¡ŒReactorå¼€å‘ï¼Œæœ€åæ¼”ç¤ºäº†Reactorçš„ä¸€äº›å¸¸è§æ“ä½œã€‚



æœ¬æ–‡ç¤ºä¾‹ä»£ç åœ°å€ï¼š[https://gitee.com/jeker8chen/react-demo.git](https://gitee.com/jeker8chen/react-demo.git)

---

**å…³æ³¨ç¬”è€…å…¬ä¼—å·ï¼Œæ¨é€å„ç±»åŸåˆ›/ä¼˜è´¨æŠ€æœ¯æ–‡ç«  â¬‡ï¸**

![WechatIMG6](http://dxsn-1300740068.cos.ap-nanjing.myqcloud.com/2021-12-11-162920.jpg)
