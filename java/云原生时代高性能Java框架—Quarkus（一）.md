[è¿”å›ä¸Šå±‚](index)
# äº‘åŸç”Ÿæ—¶ä»£é«˜æ€§èƒ½Javaæ¡†æ¶â€”Quarkusï¼ˆä¸€ï¼‰

*Quarkus&GraalVMä»‹ç»ã€åˆ›å»ºå¹¶å¯åŠ¨ç¬¬ä¸€ä¸ªé¡¹ç›®*

------

***Quarkusç³»åˆ—åšæ–‡***

- *Quarkus&GraalVMä»‹ç»ã€åˆ›å»ºå¹¶å¯åŠ¨ç¬¬ä¸€ä¸ªé¡¹ç›®*
- *[æ„å»ºQuarkusæœ¬åœ°é•œåƒã€å®¹å™¨åŒ–éƒ¨ç½²Quarkusé¡¹ç›®](äº‘åŸç”Ÿæ—¶ä»£é«˜æ€§èƒ½Javaæ¡†æ¶â€”Quarkusï¼ˆäºŒï¼‰)*
- *...*

------

## Quarkusä»‹ç»

Quarkus æ˜¯ä¸€ä¸ªä¸º **Java è™šæ‹Ÿæœºï¼ˆJVMï¼‰**å’Œ**åŸç”Ÿç¼–è¯‘ï¼ˆnative compilationï¼‰**è€Œè®¾è®¡çš„å…¨æ ˆKubernetes åŸç”Ÿ [Java æ¡†æ¶](https://www.redhat.com/zh/topics/cloud-native-apps/what-is-a-Java-framework)ï¼Œç”¨äºä¼˜åŒ–Javaç‰¹åˆ«æ˜¯Javaé¡¹ç›®çš„å®¹å™¨åŒ–ï¼Œå¹¶ä½¿å…¶æˆä¸º[serverless](https://www.redhat.com/en/topics/cloud-native-apps/what-is-serverless)ã€[äº‘](https://www.redhat.com/en/topics/cloud)å’Œ [Kubernetes](https://www.redhat.com/en/topics/containers/what-is-kubernetes) ç¯å¢ƒçš„é«˜æ•ˆå¹³å°ã€‚

Quarkus å¯ä¸å¸¸ç”¨ Java æ ‡å‡†ã€æ¡†æ¶å’Œåº“ååŒå·¥ä½œï¼Œä¾‹å¦‚ Eclipse MicroProfileã€Apache Kafkaã€RESTEasyï¼ˆJAX-RSï¼‰ã€Hibernate ORMï¼ˆJPAï¼‰ã€Springã€Infinispanã€Camel ç­‰ã€‚

Quarkus çš„ä¾èµ–æ³¨å…¥è§£å†³æ–¹æ¡ˆåŸºäº CDIï¼ˆä¸Šä¸‹æ–‡å’Œä¾èµ–æ³¨å…¥ï¼‰ï¼Œä¸”åŒ…å«ä¸€ä¸ªæ‰©å±•æ¡†æ¶æ¥æ‰©å±•åŠŸèƒ½å¹¶å°†å…¶é…ç½®ã€å¼•å¯¼å¹¶é›†æˆåˆ°æ‚¨çš„åº”ç”¨ä¸­ã€‚æ·»åŠ [æ‰©å±•](https://quarkus.io/extensions/)å°±åƒæ·»åŠ ä¾èµ–é¡¹ä¸€æ ·å®¹æ˜“ï¼›æˆ–è€…ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ Quarkus å·¥å…·ã€‚

æ­¤å¤–ä¹Ÿæ˜¯å¼•äººæ³¨ç›®çš„ä¸€ä¸ªç‰¹ç‚¹ï¼Œå®ƒè¿˜å‘ GraalVMï¼ˆä¸€ç§é€šç”¨è™šæ‹Ÿæœºï¼Œç”¨äºè¿è¡Œä»¥å¤šç§è¯­è¨€ï¼ˆåŒ…æ‹¬ Java å’Œ JavaScriptï¼‰ç¼–å†™çš„åº”ç”¨ï¼‰æä¾›æ­£ç¡®ä¿¡æ¯ï¼Œä»¥ä¾¿å¯¹åº”ç”¨è¿›è¡ŒåŸç”Ÿç¼–è¯‘ã€‚

Rad Hatåˆ—å‡ºäº†ä¸€ä¸‹æ¸…å•æ¥è¡¨æ˜ä½¿ç”¨Quarkusçš„å¥½å¤„ï¼š[æ£€æŸ¥æ¸…å•](https://www.redhat.com/cms/managed-files/cl-4-reasons-try-quarkus-checklist-f19180cs-201909-a4-zh.pdf)

### Quarkusä¸ä¼ ç»ŸJavaæ¡†æ¶å¯¹æ¯”

![img](http://dxsn-1300740068.cos.ap-nanjing.myqcloud.com/2021-12-11-110824.jpg)Quarkusä¸ä¼ ç»ŸæŠ€æœ¯æ ˆå¯¹æ¯”

æ¥è‡ªå®˜æ–¹çš„ä¸€å¼ å›¾ï¼Œå±•ç¤ºäº†ä½¿ç”¨Quarkusæ¡†æ¶å¼€å‘é¡¹ç›®å’Œä½¿ç”¨ä¼ ç»Ÿæ¡†æ¶å¼€å‘çš„ä¸€äº›è¿è¡Œæ—¶æ•°æ®æ˜ç»†å¯¹æ¯”ï¼Œå¯ä»¥çœ‹åˆ°Quarkusé¡¹ç›®åœ¨JVMä¸­è¿è¡Œæ—¶æ‰€æ¶ˆè€—çš„å†…å­˜å’Œæ¥å£å“åº”èƒ½åŠ›è¦æ˜æ˜¾å¥½äºä¼ ç»Ÿçš„JavaæŠ€æœ¯æ ˆã€‚è€Œå°†Quarkusç¼–è¯‘æˆæœ¬åœ°å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆæœ¬åœ°é•œåƒï¼‰ä¹‹åï¼Œå…¶ä¼˜åŠ¿å¯ä»¥è¯´éå¸¸æ˜æ˜¾äº†ã€‚

## GraalVMç®€ä»‹

GraalVMæ˜¯ä¸€ç§é«˜æ€§èƒ½çš„è™šæ‹Ÿæœºï¼Œå®ƒå¯ä»¥æ˜¾è‘—çš„æé«˜ç¨‹åºçš„æ€§èƒ½å’Œè¿è¡Œæ•ˆç‡ï¼Œéå¸¸é€‚åˆå¾®æœåŠ¡ã€‚å…¶è®¾è®¡åˆè¡·æ˜¯å®ç°å¯ä»¥è¿è¡Œä¸åŒè¯­è¨€ï¼ˆJavaã€JavaScriptã€åŸºäºLLVMçš„è¯­è¨€ï¼ˆä¾‹å¦‚Cå’ŒC ++ï¼‰ä»¥åŠå…¶ä»–åŠ¨æ€è¯­è¨€ï¼‰ç¼–å†™çš„åº”ç”¨ç¨‹åºã€‚å®ƒæ¶ˆé™¤äº†ä¸åŒç¼–ç¨‹è¯­è¨€ä¹‹é—´çš„éš”é˜‚ï¼Œå¹¶å®ç°äº†å¤šè¯­è¨€å…±äº«è¿è¡Œæ—¶çš„äº’æ“ä½œæ€§ã€‚å®ƒå¯ä»¥ç‹¬ç«‹è¿è¡Œï¼Œä¹Ÿå¯ä»¥åœ¨OpenJDKï¼ŒNode.jsæˆ–Oracleæ•°æ®åº“çš„ä¸Šä¸‹æ–‡ä¸­è¿è¡Œã€‚

![GraalVM system diagram](http://dxsn-1300740068.cos.ap-nanjing.myqcloud.com/2021-12-11-110833.jpg)

å¯¹äºJavaåº”ç”¨ç¨‹åºï¼ŒGraalVMå¯ä»¥å¸¦æ¥å¾ˆå¤šæœ‰ä»·å€¼çš„å¥½å¤„ï¼šæ›´å¿«åœ°è¿è¡Œå®ƒä»¬ï¼Œé€šè¿‡è„šæœ¬è¯­è¨€ï¼ˆJavaScript, R, Python...ï¼‰æä¾›å¯æ‰©å±•æ€§æˆ–åˆ›å»ºæå‰ç¼–è¯‘çš„æœ¬æœºæ˜ åƒï¼ˆnative-imageï¼‰ã€‚

æ›´å¤šå…³äºGraalVMçš„ä¿¡æ¯å¯å‚è€ƒï¼š[æ­¤ç¯‡æ–‡ç« ](http://blog.dongxishaonian.tech/archives/799)ã€‚

## GraalVMå®‰è£…

æœ¬æ–‡æˆ‘ä»¬ä½¿ç”¨[SDKMAN](https://sdkman.io/)æ¥å®‰è£…GraalVMã€‚SDKMANæ˜¯ä¸€æ¬¾ç”¨äºåœ¨å¤§å¤šæ•°åŸºäºUnixçš„ç³»ç»Ÿä¸Šç®¡ç†å¤šä¸ªè½¯ä»¶å¼€å‘å¥—ä»¶çš„å¹¶è¡Œç‰ˆæœ¬çš„å·¥å…·ã€‚å®ƒæä¾›äº†ä¸€ä¸ªæ–¹ä¾¿çš„å‘½ä»¤è¡Œç•Œé¢ï¼ˆCLIï¼‰å’ŒAPIï¼Œç”¨äºå®‰è£…ï¼Œåˆ‡æ¢ï¼Œåˆ é™¤å’Œåˆ—å‡ºå€™é€‰äººã€‚å®ƒä»¥å‰è¢«ç§°ä¸ºGroovy enVironment Manager ï¼ˆGVMï¼‰ï¼Œå—åˆ°äº†éå¸¸æœ‰ç”¨çš„RVMå’Œrbenvå·¥å…·çš„å¯å‘ï¼Œè¯¥å·¥å…·åœ¨Rubyç¤¾åŒºä¸­å¹¿æ³›ä½¿ç”¨ã€‚

### å®‰è£…SDKMAN

è¿è¡Œå¦‚ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£…ï¼š

```bash
$ curl -s "https://get.sdkman.io" | bash
$ source "$HOME/.sdkman/bin/sdkman-init.sh"	
```

è¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼ŒéªŒè¯æ˜¯å¦å·²å®‰è£…ADKMANï¼š

```bash
$ sdk version
```

### å®‰è£…GraalVM

è¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š

```bash
$ sdk list java
```

å¯ä»¥çœ‹åˆ°SDKMANåˆ—å‡ºäº†æ‰€æ”¯æŒçš„æ‰€æœ‰Javaå‘è¡Œç‰ˆ

![image-20200717142755813](http://dxsn-1300740068.cos.ap-nanjing.myqcloud.com/2021-12-11-110839.jpg)

æˆ‘ä»¬æ‰¾åˆ°GraalVMçš„å‘è¡Œç‰ˆ

![image-20200717142840033](http://dxsn-1300740068.cos.ap-nanjing.myqcloud.com/2021-12-11-110845.jpg)

æˆªè‡³ç¼–å†™æœ¬æ–‡æ—¶ï¼ŒGraalVMçš„æœ€æ–°ç‰ˆæœ¬ä¸º20.1.0.r11-grlï¼Œæ‰€ä»¥æˆ‘ä»¬ä¼šå®‰è£…æ­¤ç‰ˆæœ¬ã€‚è¿è¡Œå¦‚ä¸‹å‘½ä»¤å®‰è£…GraalVMï¼š

```bash
$ sdk install java 20.1.0.r11-grl
```

è‡³æ­¤ï¼ŒGraalVMå®‰è£…å®Œæ¯•ï¼æˆ‘ä»¬å¯ä»¥è¿è¡Œå¦‚ä¸‹å‘½ä»¤æ¥åˆ¤æ–­GraalVMæ˜¯å¦å·²å®‰è£…ï¼š

```bash
$ java -version
```

![image-20200717143216643](http://dxsn-1300740068.cos.ap-nanjing.myqcloud.com/2021-12-11-110850.jpg)

## åˆ›å»ºé¡¹ç›®

æˆ‘ä»¬æœ‰å¤šç§æ–¹å¼åˆ›å»ºQuarkusé¡¹ç›®

### ä½¿ç”¨Intellij IDEAåˆ›å»ºQuarkusé¡¹ç›®

ç‚¹å‡»èœå•æ File>New>Project... åˆ›å»ºæ–°é¡¹ç›®

![image-20200717150609041](http://dxsn-1300740068.cos.ap-nanjing.myqcloud.com/2021-12-11-110854.jpg)

ç‚¹å‡»Nextï¼Œå¹¶å¡«å†™é€‚å½“çš„ä¿¡æ¯ï¼ŒNext>Next...,åˆ›å»ºå®Œæ¯•ã€‚

### ä½¿ç”¨Mavenå‘½ä»¤è¡Œåˆ›å»ºQuarkusé¡¹ç›®

è¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œåˆ›å»ºQuarkusé¡¹ç›®ï¼š

```bash
mvn io.quarkus:quarkus-maven-plugin:1.6.0.Final:create \
    -DprojectGroupId=org.acme \
    -DprojectArtifactId=getting-started \
    -DclassName="org.acme.getting.started.GreetingResource" \
    -Dpath="/hello"
cd getting-started
```

è‡³æ­¤ï¼Œåˆ›å»ºé¡¹ç›®å®Œæ¯•ï¼

## å¯åŠ¨é¡¹ç›®

æˆ‘ä»¬ä½¿ç”¨IDEAæ‰“å¼€é¡¹ç›®

![image-20200717152929281](http://dxsn-1300740068.cos.ap-nanjing.myqcloud.com/2021-12-11-110902.jpg)

Quarkuså¹¶æ²¡æœ‰ç±»ä¼¼Spring Bootã€Helidonä¹‹ç±»æ¡†æ¶ä¸€æ ·çš„å¯åŠ¨ç±»ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡è¿è¡ŒMavenå‘½ä»¤æ¥å¯åŠ¨é¡¹ç›®ã€‚

åœ¨IDEAæ§åˆ¶å°è¿è¡Œå¦‚ä¸‹å‘½ä»¤æ¥å¯åŠ¨é¡¹ç›®:

```bash
./mvnw compile quarkus:dev
```

å¯åŠ¨æˆåŠŸï¼

![image-20200717153314096](http://dxsn-1300740068.cos.ap-nanjing.myqcloud.com/2021-12-11-110907.jpg)

å½“ç„¶æ¯æ¬¡è¿è¡Œå‘½ä»¤è¡Œä¼šæ˜¾å¾—ä¸ä¾¿ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¦‚ä¸‹é…ç½®æ¥é…ç½®é¡¹ç›®å¿«æ·å¯åŠ¨ï¼š

![image-20200717153444892](http://dxsn-1300740068.cos.ap-nanjing.myqcloud.com/2021-12-11-110915.jpg)

ç‚¹å‡»å·¦ä¸Šè§’"+"å›¾æ ‡æ·»åŠ ä¸€ä¸ªMavené…ç½®å¦‚å·¦è¾¹æ ï¼Œåœ¨å³è¾¹æ ä¸­çš„Command lineä¸­å¡«å…¥"compile quarkus:dev"ï¼Œç‚¹å‡»OKã€‚

![image-20200717153542033](http://dxsn-1300740068.cos.ap-nanjing.myqcloud.com/2021-12-11-110920.jpg)

æ­¤æ—¶å¯ä»¥ç‚¹ä¸‹ä¸‹å›¾æ‰€ç¤ºå›¾æ ‡æ¥ä¾¿æ·å¯åŠ¨é¡¹ç›®

![image-20200717153914940](http://dxsn-1300740068.cos.ap-nanjing.myqcloud.com/2021-12-11-110927.jpg)

## è¿è¡Œæµ‹è¯•

æ‰“å¼€é¡¹ç›®ä¸­çš„æµ‹è¯•ç±»ï¼Œçœ‹åˆ°å¦‚ä¸‹ä»£ç ï¼š

```java
@QuarkusTest  //1
public class ExampleResourceTest {
    @Test
    public void testHelloEndpoint() {
        given()
            .when().get("/hello")
            .then()
            .statusCode(200) //2
            .body(is("hello"));
    }
}
```

1. é€šè¿‡ä½¿ç”¨@QuarkusTestæ³¨è§£è¿è¡Œç¨‹åºï¼Œå¯ä»¥æŒ‡ç¤ºJUnitåœ¨æµ‹è¯•ä¹‹å‰å¯åŠ¨åº”ç”¨ç¨‹åºã€‚
2. æ£€æŸ¥HTTPå“åº”çŠ¶æ€ä»£ç å’Œå†…å®¹ã€‚

é»˜è®¤æƒ…å†µä¸‹ï¼Œæµ‹è¯•å°†åœ¨ç«¯å£8081ä¸Šè¿è¡Œï¼Œä»¥å…ä¸æ­£åœ¨è¿è¡Œçš„åº”ç”¨ç¨‹åºå†²çªã€‚Quarkusè‡ªåŠ¨å°†RestAssuredé…ç½®ä¸ºä½¿ç”¨æ­¤ç«¯å£ã€‚å¦‚æœè¦æµ‹è¯•å…¶ä»–è·¯å¾„ï¼Œåˆ™å¯ä»¥ä½¿ç”¨@TestHTTPResourceæ³¨è§£å°†è¢«æµ‹è¯•çš„URLç›´æ¥æ³¨å…¥åˆ°æµ‹è¯•ç±»çš„å­—æ®µä¸­ã€‚è¯¥å­—æ®µçš„ç±»å‹å¯ä»¥æ˜¯å­—ç¬¦ä¸²ï¼ŒURLæˆ–URIã€‚æˆ‘ä»¬éœ€è¦ä¸ºè¯¥æ³¨è§£æŒ‡å®šæµ‹è¯•è·¯å¾„çš„å€¼ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘è¦æµ‹è¯•æ˜ å°„åˆ°/myservletçš„Servletï¼Œåªéœ€åœ¨æµ‹è¯•ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š

```java
@QuarkusTest  
public class ExampleResourceTest {
    @TestHTTPResource("/myservlet")
    URL testUrl;

    @Test
    public void testHelloEndpoint() {
        given()
            .when().get(testUrl)
            .then()
            .statusCode(200) 
            .body(is("hello"));
    }
}
```

å¯ä»¥é€šè¿‡åœ¨é¡¹ç›®é…ç½®æ–‡ä»¶ä¸­é…ç½®quarkus.http.test-portå±æ€§æ§åˆ¶æµ‹è¯•ç«¯å£ã€‚ Quarkusè¿˜åˆ›å»ºäº†ä¸€ä¸ªåä¸ºtest.urlçš„ç³»ç»Ÿå±æ€§ï¼Œè¯¥å±æ€§å€¼å°†è¢«è®¾ç½®æˆåŸºç¡€æµ‹è¯•URLï¼ˆBasePathï¼‰ã€‚

## æ€»ç»“

æˆ‘ä»¬è¿›å…¥äº†äº‘åŸç”Ÿã€å¾®æœåŠ¡çš„æ—¶ä»£ï¼Œæˆ‘ä»¬å‘Šåˆ«äº†å¤§å‹å•ä½“åº”ç”¨çš„åºå¤§å’Œå¤æ‚ï¼Œå¹¶ä¸”æ”¶è·äº†å¾®æœåŠ¡å¸¦æ¥çš„æå¤§çš„å¥½å¤„ ã€‚ä½†æ˜¯ä¸€äº›é—®é¢˜ä¹Ÿå¼€å§‹æ¥è¸µè€Œè‡³ã€‚éšç€å¾®å°æœåŠ¡çš„å¢å¤šï¼Œæ›¾ç»åœ¨å•ä¸ªåº”ç”¨ä¸Šå‘ç”Ÿçš„å¤šä½™æ— ç”¨ä¾èµ–ã€Javaé¡¹ç›®ä¸ç”Ÿä¿±æ¥çš„å¯åŠ¨è¿‡ç¨‹ç¼“æ…¢ã€JITä¼˜åŒ–é—®é¢˜æ‰©æ•£åˆ°äº†æ¯ä¸ªå¾®æœåŠ¡ä¸Šé¢ã€‚è€Œä¸”ä¼ ç»Ÿçš„Java EEè§„èŒƒå¹¶æ²¡æœ‰å¾®æœåŠ¡çš„æ¨¡å¼è§£å†³æ–¹æ¡ˆï¼Œé—®é¢˜å¾ˆè¿«åˆ‡éœ€è¦è§£å†³ã€‚å¹¸è¿çš„äº‹ï¼Œéšç€Quarkusã€Helidonç­‰ç­‰ä¸€äº›æ–°å‹Javaå¼€å‘æ¡†æ¶çš„å‡ºç°ç¼“è§£äº†è¿™ä¸ªå±€é¢ï¼ˆä»¥åŠç›®å‰Springç”Ÿæ€ä¹Ÿå¼€å§‹äº†å¯¹GraalVMçš„å¤§åŠ›æ”¯æŒï¼‰ï¼Œä»–ä»¬ä½¿Javaå˜å¾—æ›´åŠ æœ¬åœ°åŒ–ï¼Œä¸ç®¡æ˜¯é¡¹ç›®çš„ä½“é‡æ–¹é¢è¿˜æ˜¯èµ„æºæ¶ˆè€—å’Œè¿è¡Œæ•ˆç‡æ–¹é¢éƒ½æœ‰æ˜¾è‘—æå‡ã€‚







---
---
---


## ğŸ¤”  ğŸ’­ ğŸ‘‡ğŸ‘‡ğŸ‘‡

<script src="https://utteranc.es/client.js"
        repo="dongxishaonian/issue-posted"
        issue-term="pathname"
        label="ğŸ™‚ğŸ™ƒğŸ˜¡ğŸ¥¶ğŸ˜¬ğŸ¤£ğŸ˜„"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>

